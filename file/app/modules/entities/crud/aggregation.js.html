<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../">
  <title data-ice="title">app/modules/entities/crud/aggregation.js | PolarisOS</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="MyScienceWork provides a suite of data-driven solutions for research institutions, scientific publishers and private-sector R&amp;D companies. MyScienceWork&apos;s comprehensive database includes more than 70 million scientific publications and 12 million patents."><meta property="og:type" content="website"><meta property="og:url" content="https://www.mysciencework.com"><meta property="og:site_name" content="PolarisOS"><meta property="og:title" content="PolarisOS"><meta property="og:image" content="https://www.mysciencework.com/bundles/home/images/logo-primary-medium.png"><meta property="og:description" content="MyScienceWork provides a suite of data-driven solutions for research institutions, scientific publishers and private-sector R&amp;D companies. MyScienceWork&apos;s comprehensive database includes more than 70 million scientific publications and 12 million patents."><meta property="og:author" content="MyScienceWork"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="PolarisOS"><meta property="twitter:description" content="MyScienceWork provides a suite of data-driven solutions for research institutions, scientific publishers and private-sector R&amp;D companies. MyScienceWork&apos;s comprehensive database includes more than 70 million scientific publications and 12 million patents."><meta property="twitter:image" content="https://www.mysciencework.com/bundles/home/images/logo-primary-medium.png"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.png" style="width:34px;"></a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/MyScienceWork/PolarisOS"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create">create</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-update">update</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#csl-styles">csl_styles</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-add_styles">add_styles</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#initializations">initializations</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initialize_routes">initialize_routes</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-3rdparty-rss">modules/3rdparty/rss</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_rss_feed">generate_rss_feed</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-routes">routes</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-auth">modules/auth</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-FilterSchema">FilterSchema</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-entities-crud">modules/entities/crud</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/modules/entities/crud/odm.js~ODM.html">ODM</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_sort">get_sort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-transform_to_aggregation">transform_to_aggregation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-transform_to_search">transform_to_search</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-transform_to_sort">transform_to_sort</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-entities-crud-controllers">modules/entities/crud/controllers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-count">count</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-del">del</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get">get</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-gets">gets</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-post">post</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-post_with_action">post_with_action</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-put">put</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-put_with_action">put_with_action</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-search">search</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-validate">validate</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-entities-exporter-controllers">modules/entities/exporter/controllers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_author_info">get_author_info</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_edition_stmt">get_edition_stmt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_monogr">get_monogr</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_notes_stmt">get_notes_stmt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_profile_desc">get_profile_desc</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_publication_stmt">get_publication_stmt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_series_stmt">get_series_stmt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_source_desc">get_source_desc</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_title_stmt">get_title_stmt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-transform_publication_to_hal">transform_publication_to_hal</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-entities-mswpublication-controllers">modules/entities/mswpublication/controllers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-send_email">send_email</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-entities-role-controllers">modules/entities/role/controllers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-access">access</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-authenticate">authenticate</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-entities-user-controllers">modules/entities/user/controllers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-access">access</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-authenticate">authenticate</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-entities-user-routes">modules/entities/user/routes</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-routes">routes</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-exceptions">modules/exceptions</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GenericException">GenericException</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-pipeline">modules/pipeline</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/modules/pipeline/pipeline.js~Pipeline.html">Pipeline</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-pipeline-completer">modules/pipeline/completer</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-complete">complete</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-pipeline-completer-complfunctions">modules/pipeline/completer/complfunctions</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-denormalization">denormalization</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generic_complete">generic_complete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initial">initial</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-key_complete">key_complete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-secret_complete">secret_complete</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-pipeline-formatter">modules/pipeline/formatter</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-format">format</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatting">formatting</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-pipeline-formatter-formatfunctions">modules/pipeline/formatter/formatfunctions</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-filter_empty_or_null_objects">filter_empty_or_null_objects</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-format_string">format_string</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generic_formatter">generic_formatter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-oarray_to_array">oarray_to_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-set_default_lang_for_array">set_default_lang_for_array</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-pipeline-transformer">modules/pipeline/transformer</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-apply_transducer">apply_transducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-transform">transform</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-pipeline-transformer-transfunctions">modules/pipeline/transformer/transfunctions</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-flatten">flatten</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_in_list">get_in_list</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-identity">identity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-template_identity">template_identity</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-pipeline-validator">modules/pipeline/validator</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/modules/pipeline/validator/validator.js~Validator.html">Validator</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-pipeline-validator-valfunctions">modules/pipeline/validator/valfunctions</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-if_exists">if_exists</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-is_conditioned_on">is_conditioned_on</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-is_unique">is_unique</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-is_valid_json">is_valid_json</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#modules-utils">modules/utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cas_auth">cas_auth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-do_standard_checks">do_standard_checks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-find_through_ldap">find_through_ldap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-find_user">find_user</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_cas_info">get_cas_info</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-login_auth">login_auth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-map_ldap_to_pos">map_ldap_to_pos</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-escape_from_bibtex">escape_from_bibtex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-escape_to_bibtex">escape_to_bibtex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_key">generate_key</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_secret">generate_secret</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_config">get_config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_language_values">get_language_values</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_language_values_from_langs">get_language_values_from_langs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_language_values_from_langs_and_keys">get_language_values_from_langs_and_keys</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-retrieve_single_quantity">retrieve_single_quantity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_smtp_transport">get_smtp_transport</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-send_email">send_email</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-send_email_through_smtp">send_email_through_smtp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-send_email_with">send_email_with</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-api_middlewares">api_middlewares</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-app_middlewares">app_middlewares</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-del_middlewares">del_middlewares</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_del_routes">generate_del_routes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_entity_routes">generate_entity_routes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_get_routes">generate_get_routes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_gets_routes">generate_gets_routes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_post_routes">generate_post_routes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_put_routes">generate_put_routes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_middlewares">get_middlewares</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-koa_middlewares">koa_middlewares</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-post_middlewares">post_middlewares</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-put_middlewares">put_middlewares</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-upload_middlewares">upload_middlewares</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-is_valid_stream">is_valid_stream</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-to_array">to_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-to_buffer">to_buffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-add_single">add_single</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-download">download</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-multi_download">multi_download</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_return_inner_object">_return_inner_object</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_test_inner_object">_test_inner_object</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-filter_empty_or_null_objects">filter_empty_or_null_objects</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-find_object_with_path">find_object_with_path</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-find_popvalue_with_path">find_popvalue_with_path</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-find_value_with_path">find_value_with_path</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-forge_whitelist_blacklist_query">forge_whitelist_blacklist_query</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hasProperty">hasProperty</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isNil">isNil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-make_nested_object_from_path">make_nested_object_from_path</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-merge_with_concat">merge_with_concat</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-merge_with_replacement">merge_with_replacement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-merge_with_superposition">merge_with_superposition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-traverse_and_execute">traverse_and_execute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-traverse_recreate_and_execute">traverse_recreate_and_execute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-forge_ok_response">forge_ok_response</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-strip_xhtml_tags">strip_xhtml_tags</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-to_object">to_object</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">app/modules/entities/crud/aggregation.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">// @flow
const _ = require(&apos;lodash&apos;);

class Aggregation {
    _name: string;
    _object: Object;
    _field: ?string;

    constructor(name: string, object: Object = {}) {
        this._name = name;
        this._object = object;
        this._field = &apos;field&apos; in object ? object.field : null;
    }

    get name(): string {
        return this._name;
    }

    field(f: string) {
        this._field = f;
        return this;
    }

    generate(): Object {
        return this._object;
    }
}

class TopHitsAggregation extends Aggregation {
    _size: number;
    _from: number;
    _sort: Array&lt;Object&gt;;
    _source: ?Object;

    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._name = name;
        this._object = object;
        this._size = &apos;size&apos; in object ? object.size : 0;
        this._from = &apos;from&apos; in object ? object.from : 0;
        this._sort = &apos;sort&apos; in object ? object.sort : [];
        this._source = &apos;_source&apos; in object ? object._source : null;
    }

    size(s: number): TopHitsAggregation {
        this._size = s;
        return this;
    }

    from(f: number): TopHitsAggregation {
        this._from = f;
        return this;
    }

    sort(s: Array): TopHitsAggregation {
        this._sort = s;
        return this;
    }

    source(s: ?Object): TopHitsAggregation {
        this._source = source;
        return this;
    }

    generate(): Object {
        const obj = {
            [this._name]: {},
        };

        obj[this._name] = {
            top_hits: {
                sort: this._sort,
                size: this._size,
                from: this._from,
            },
        };

        if (this._source) {
            obj[this._name].top_hits._source = this._source;
        }

        return obj;
    }
}

class MetricAggregation extends Aggregation {
}

class SingleValueMetricAggregation extends MetricAggregation {
    _missing: any;
    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._missing = &apos;missing&apos; in object ? object.missing : null;
    }

    missing(v: any) {
        if (v == null) {
            return this;
        }
        this._missing = v;
        return this;
    }


    generate() {
        const obj = {
            [this._name]: {},
        };

        const subobj = {
            field: this._field,
        };

        if (this._missing != null) {
            subobj.missing = this._missing;
        }

        const cname = this.constructor.name.toLowerCase().replace(&apos;aggregation&apos;, &apos;&apos;);
        if (cname === &apos;valuecount&apos;) {
            obj[this._name].value_count = subobj;
        } else {
            obj[this._name][cname] = subobj;
        }
        return obj;
    }
}

class AvgAggregation extends SingleValueMetricAggregation {}
class MinAggregation extends SingleValueMetricAggregation {}
class MaxAggregation extends SingleValueMetricAggregation {}
class SumAggregation extends SingleValueMetricAggregation {}
class ValueCountAggregation extends SingleValueMetricAggregation {
    missing() {
        // Not existent for this aggregation
        return this;
    }
}
class CardinalityAggregation extends SingleValueMetricAggregation {
    _precision_threshold: number;
    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._precision_threshold = &apos;precision_threshold&apos; in object ? object.precision_threshold : 3000; // Default in ES;
    }

    precision_threshold(n: number) {
        if (typeof n !== &apos;number&apos;) {
            return this;
        }
        this._precision_threshold = n;
        return this;
    }

    generate(): Object {
        const obj = super.generate();
        obj[this._name].cardinality.precision_threshold = this._precision_threshold;
        return obj;
    }
}

class MultiValueMetricAggregation extends SingleValueMetricAggregation {
}

class ExtendedStatsAggregation extends MultiValueMetricAggregation {
    _sigma: ?number;
    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._sigma = &apos;sigma&apos; in object ? object.sigma : null;
    }

    sigma(v: number): Aggregation {
        this._sigma = v;
        return this;
    }

    generate(): Object {
        return this;
    }
}

class StatsAggregation extends MultiValueMetricAggregation {
    generate(): Object {
        return this;
    }
}

class PercentilesAggregation extends MultiValueMetricAggregation {
    _percents: Array&lt;number&gt;;
    _keyed: boolean;
    _hdr_significant_value_digits: number;
    _hdr: boolean;
    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._percents = &apos;percents&apos; in object ? object.percents : [];
        this._keyed = &apos;keyed&apos; in object ? object.keyed : true;
        this._hdr = &apos;hdr&apos; in object;
        this._hdr_significant_value_digits = &apos;hdr&apos; in object
            &amp;&amp; &apos;number_of_significant_value_digits&apos; in object.hdr ? object.hdr.number_of_significant_value_digits : 3;
    }

    percents(arr: Array&lt;number&gt;): Aggregation {
        this._percents = arr;
        return this;
    }

    keyed(b: boolean): Aggregation {
        this._keyed = b;
        return this;
    }

    hdr_significant_digits(d: number): Aggregation {
        this._hdr = true;
        this._hdr_significant_value_digits = d;
        return this;
    }

    generate(): Object {
        return this;
    }
}

class PercentileRanksAggregation extends PercentilesAggregation {
    _values: Array&lt;number&gt;;
    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._values = &apos;values&apos; in object ? object.values : [];
    }

    values(arr: Array&lt;number&gt;): Aggregation {
        this._values = arr;
        return this;
    }

    generate(): Object {
        return this;
    }
}

class BucketAggregation extends Aggregation {
    _sub_aggregations: Array&lt;Aggregation&gt;;
    _keyed: boolean;
    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._sub_aggregations = [];
        this._keyed = &apos;keyed&apos; in object ? object.keyed : false;
    }

    aggregation(agg: Aggregation) {
        this._sub_aggregations.push(agg);
        return this;
    }
}

class NestedAggregation extends BucketAggregation {
    _path: ?string;
    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._path = &apos;path&apos; in object ? object.path : null;
    }

    path(p: string) {
        this._path = p;
        return this;
    }

    generate() {
        return {
            [this._name]: {
                nested: {
                    path: this._path,
                },
                aggs: this._sub_aggregations.reduce((obj, agg) =&gt; {
                    obj = _.merge(obj, agg.generate());
                    return obj;
                }, {}),
            },
        };
    }
}

class FilterAggregation extends BucketAggregation {
    _query: ?Object;
    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._query = null;
    }

    query(q: Object) {
        this._query = q;
        return this;
    }

    generate() {
        return {
            [this._name]: {
                filter: this._query == null ? {} : this._query,
                aggs: this._sub_aggregations.reduce((obj, agg) =&gt; {
                    obj = _.merge(obj, agg.generate());
                    return obj;
                }, {}),
            },
        };
    }
}

class TermsAggregation extends BucketAggregation {
    _include: ?string | ?Array&lt;string&gt;;
    _exclude: ?string | ?Array&lt;string&gt;;
    _missing: any;
    _size: number;
    _shard_size: number;
    _min_doc_count: number;
    _shard_min_doc_count: number;
    _order: ?Object;

    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._include = &apos;include&apos; in object ? object.include : null;
        this._exclude = &apos;exclude&apos; in object ? object.exclude : null;
        this._missing = &apos;missing&apos; in object ? object.missing : null;
        this._size = &apos;size&apos; in object ? object.size : 10;
        this._shard_size = &apos;shard_size&apos; in object ? object.shard_size : this._size;
        this._min_doc_count = &apos;min_doc_count&apos; in object ?
            object.min_doc_count : 1;
        this._shard_min_doc_count = &apos;shard_min_doc_count&apos; in object ?
            object.shard_min_doc_count : 1;
        // Check with an enum TODO
        this._collect_mode = &apos;collect_mode&apos; in object ? object.collect_mode : null;
        this._order = &apos;order&apos; in object ? this._extract_order(object.order) : null;
    }

    _extract_order(order: Object): ?Object {
        if (order &amp;&amp; Object.keys(order).length === 1) {
            const keys = Object.keys(order);
            const key = keys[0];
            if (order[key] === &apos;desc&apos; || order[key] === &apos;asc&apos;) {
                return order;
            }
            return null;
        }
        return null;
    }

    include(inc: string | Array&lt;string&gt;) {
        this._include = inc;
        return this;
    }

    exclude(exc: string | Array&lt;string&gt;) {
        this._exclude = exc;
        return this;
    }

    missing(m: any) {
        this._missing = m;
        return this;
    }

    size(s: number) {
        this._size = s;
        return this;
    }

    shard_size(s: number) {
        this._shard_size = s;
        return this;
    }

    min_doc_count(dc: number) {
        this._min_doc_count = dc;
        return this;
    }

    shard_min_doc_count(dc: number) {
        this._shard_min_doc_count = dc;
        return this;
    }

    generate() {
        const obj = {
            [this._name]: {
                terms: {
                    field: this._field,
                },
            },
        };

        obj[this._name].terms.size = this._size;
        obj[this._name].terms.shard_size = this._shard_size;
        obj[this._name].terms.shard_size = this._shard_size;
        obj[this._name].terms.min_doc_count = this._min_doc_count;
        obj[this._name].terms.shard_min_doc_count = this._shard_min_doc_count;

        if (this._missing != null) {
            obj[this._name].terms.missing = this._missing;
        }

        if (this._include != null) {
            obj[this._name].terms.include = this._include;
        }

        if (this._exclude != null) {
            obj[this._name].terms.exclude = this._exclude;
        }

        if (this._order != null) {
            obj[this._name].terms.order = this._order;
        }

        if (this._sub_aggregations.length &gt; 0) {
            obj[this._name].aggs = {};
            obj[this._name].aggs = this._sub_aggregations.reduce((o, agg) =&gt; {
                o = _.merge(o, agg.generate());
                return o;
            }, obj[this._name].aggs);
        }

        return obj;
    }
}

class DateHistogramAggregation extends BucketAggregation {
    _timezone: ?string;
    _offset: ?string;
    _format: ?string;
    _interval: ?string;
    _missing: any;
    _shard_size: number;
    _min_doc_count: number;
    _order: ?Object;

    constructor(name: string, object: Object = {}) {
        super(name, object);
        this._missing = &apos;missing&apos; in object ? object.missing : null;
        this._shard_size = &apos;shard_size&apos; in object ? object.shard_size : this._size;
        this._min_doc_count = &apos;min_doc_count&apos; in object ?
            object.min_doc_count : 1;
        this._format = &apos;format&apos; in object ? object.format : null;
        this._timezone = &apos;timezone&apos; in object ? object.timezone : null;
        this._interval = &apos;interval&apos; in object ? object.interval : null;
        this._offset = &apos;offset&apos; in object ? object.offset : null;
        this._order = &apos;order&apos; in object ? this._extract_order(object.order) : null;
    }

    _extract_order(order: Object): ?Object {
        if (order &amp;&amp; Object.keys(order).length === 1) {
            const keys = Object.keys(order);
            const key = keys[0];
            if (order[key] === &apos;desc&apos; || order[key] === &apos;asc&apos;) {
                return order;
            }
            return null;
        }
        return null;
    }

    missing(m: any) {
        this._missing = m;
        return this;
    }

    shard_size(s: number) {
        this._shard_size = s;
        return this;
    }

    min_doc_count(dc: number) {
        this._min_doc_count = dc;
        return this;
    }

    format(f: string): DateHistogramAggregation {
        this._format = f;
        return this;
    }

    timezone(tz: string): DateHistogramAggregation {
        this._timezone = tz;
        return this;
    }

    interval(inter: string): DateHistogramAggregation {
        this._interval = inter;
        return this;
    }

    order(o: ?Object): DateHistogramAggregation {
        this._order = this._extract_order(o);
        return this;
    }

    generate() {
        const obj = {
            [this._name]: {
                date_histogram: {
                    field: this._field,
                },
            },
        };

        obj[this._name].date_histogram.shard_size = this._shard_size;
        obj[this._name].date_histogram.shard_size = this._shard_size;
        obj[this._name].date_histogram.min_doc_count = this._min_doc_count;

        if (this._format) {
            obj[this._name].date_histogram.format = this._format;
        }

        if (this._timezone) {
            obj[this._name].date_histogram.time_zone = this._timezone;
        }

        if (this._interval) {
            obj[this._name].date_histogram.interval = this._interval;
        }

        if (this._offset) {
            obj[this._name].date_histogram.offset = this._offset;
        }

        if (this._missing != null) {
            obj[this._name].date_histogram.missing = this._missing;
        }

        if (this._order != null) {
            obj[this._name].date_histogram.order = this._order;
        }

        if (this._sub_aggregations.length &gt; 0) {
            obj[this._name].aggs = {};
            obj[this._name].aggs = this._sub_aggregations.reduce((o, agg) =&gt; {
                o = _.merge(o, agg.generate());
                return o;
            }, obj[this._name].aggs);
        }

        return obj;
    }
}

module.exports = {
    Aggregation,
    BucketAggregation,
    SingleValueMetricAggregation,
    MultiValueMetricAggregation,
    AvgAggregation,
    MinAggregation,
    MaxAggregation,
    SumAggregation,
    ValueCountAggregation,
    CardinalityAggregation,
    ExtendedStatsAggregation,
    StatsAggregation,
    PercentilesAggregation,
    PercentileRanksAggregation,
    NestedAggregation,
    FilterAggregation,
    TermsAggregation,
    DateHistogramAggregation,
    TopHitsAggregation,
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
